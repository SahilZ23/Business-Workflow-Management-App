<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Customer Navigation</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
    <link href="{% static 'style.css' %}" rel="stylesheet" type="text/css" />
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="header" class="text-center mb-4">
        <h1>    </h1>
    </div>

    <div class="container mt-4">
        <h1>Customer Details</h1>
        <p><strong>Customer Name:</strong> {{ customer.cusName }}</p>
        <p><strong>Customer Phone:</strong> {{ customer.phoneNumber }}</p> <!-- Assuming Customer model has 'name' field -->
        <p><strong>Customer Email:</strong> {{ customer.email }}</p>
        <p><strong>Customer Address:</strong> {{ cusAdd }}</p>

    </div>

    <div class="container mt-4">
        <div id="map"></div>
        <br>
        <button onclick="getDirectionsCurrentLoc()" class="btn btn-primary mb-3">Get Directions</button>
        <button onclick="getDirections()" class="btn btn-primary mb-3">Get Directions from Home</button>
        <button onclick="window.location.href='/salesRep';" class="btn btn-primary mb-3">Back</button>
    </div>

    <script>
        let map;
        let userLocation = { lat: parseFloat('{{ user_lat }}'), lng: parseFloat('{{ user_lng }}') };
        let customerLocation = { lat: parseFloat('{{ customer_lat }}'), lng: parseFloat('{{ customer_lng }}') };

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: customerLocation,
                zoom: 8
            });

            new google.maps.Marker({
                position: customerLocation,
                map: map,
                title: 'Customer Location'
            });
        }

        function getDirections() {
            window.open(`https://www.google.com/maps/dir/?api=1&origin=${userLocation.lat},${userLocation.lng}&destination=${customerLocation.lat},${customerLocation.lng}`);
        }
        function getDirectionsCurrentLoc() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const currentLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    window.open(`https://www.google.com/maps/dir/?api=1&origin=${currentLocation.lat},${currentLocation.lng}&destination=${customerLocation.lat},${customerLocation.lng}`);
                }, function() {
                    alert("Geolocation is not supported by this browser.");
                });
            } else {
                // Browser doesn't support Geolocation
                alert("Geolocation is not supported by this browser.");
            }
        }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD6v15JNhOvb1ex_lELHwV6RqF3DUBq-hQ&callback=initMap" async defer></script>

    <!-- Bootstrap framework -->
    <script src="{% static 'js/jquery-3.5.1.slim.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/bootstrap.bundle.min.js' %}" type="text/javascript"></script>
    
</body>
</html>
